@model ITIGraduation.Models.Prouduct

@{
    ViewData["Title"] = "best Sellings Details";
}

<link rel="stylesheet" href="~/style.css" asp-append-version="true" />

<div class="product_page" id="ProductView">
    <section class="main">
        <!-- ====== Gallery ====== -->
        <div class="default gallery">
            <div class="main-img">
                <img class="active" src="@Url.Content(Model.ImagUrl)" alt="@Model.ProuductName" />
                <img src="@Url.Content(Model.ImagUrl)" alt="@Model.ProuductName" />
                <img src="@Url.Content(Model.ImagUrl)" alt="@Model.ProuductName" />
                <img src="@Url.Content(Model.ImagUrl)" alt="@Model.ProuductName" />
            </div>
            <div class="thumb-list">
                @for (int i = 0; i < 4; i++)
                {
                    <div class="@(i==0?"active":"")">
                        <img src="@Url.Content(Model.ImagUrl)" alt="@Model.ProuductName" />
                    </div>
                }
            </div>
        </div>

        <!-- ====== Content ====== -->
        <div class="content">
            <h2 class="product-name">@Model.ProuductName</h2>
            <p class="product-desc">
                These sport shoes are lightweight, stylish, and built for performance.
                Perfect for running, training, and casual wear.
            </p>

            <div class="price-info">
                <div class="price">
                    <span class="current-price">$@Model.Price</span>
                    <span class="discount">30%</span>
                </div>
                <div class="prev-price">$200.00</div>
            </div>

            <!-- ====== Quantity + Add to Cart ====== -->
            <div class="add-to-cart-container">
                <div class="quantity-controller d-flex align-items-center">
                    <button class="btn btn-light minus">-</button>
                    <input type="number" id="quantity" value="1" min="1" class="form-control text-center mx-1" style="width:60px;">
                    <button class="btn btn-light plus">+</button>
                </div>

                <button class="btn btn-dark add-to-cart"
                        id="addToCartBtn"
                        data-id="@Model.ProuductId"
                        data-type="Sport">
                    <span>Add to Cart</span>
                </button>
            </div>
        </div>
    </section>
</div>

<!-- ====== Add To Cart Script ====== -->
<script>
    let quantity = 1;
    const quantityInput = document.getElementById('quantity');
    const minusBtn = document.querySelector('.minus');
    const plusBtn = document.querySelector('.plus');
    const addToCartBtn = document.getElementById('addToCartBtn');

    // Quantity control
    minusBtn.addEventListener('click', () => {
        if (quantity > 1) {
            quantity--;
            quantityInput.value = quantity;
        }
    });

    plusBtn.addEventListener('click', () => {
        quantity++;
        quantityInput.value = quantity;
    });

    quantityInput.addEventListener('input', () => {
        quantity = parseInt(quantityInput.value) || 1;
        if (quantity < 1) quantity = 1;
        quantityInput.value = quantity;
    });

    // Add to Cart
    addToCartBtn.addEventListener('click', () => {
        const productId = parseInt(addToCartBtn.getAttribute('data-id'));
        const productType = addToCartBtn.getAttribute('data-type');

        fetch('/Cart/AddToCart', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                productId: productId,
                quantity: quantity,
                productType: productType
            })
        })
        .then(response => {
            if (response.redirected) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Login Required',
                    text: 'Please log in first to add items to your cart.'
                }).then(() => {
                    window.location.href = response.url;
                });
                return;
            }
            return response.json();
        })
        .then(data => {
            if (!data) return;
            if (data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Added to Cart',
                    text: `${quantity} item(s) added. Cart now has ${data.cartCount} item(s).`,
                    confirmButtonText: 'OK'
                }).then(() => {
                    window.location.reload();
                    localStorage.setItem("openCart", "true");
                });
                quantity = 1;
                quantityInput.value = quantity;
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Something went wrong while adding the item.'
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            Swal.fire({
                icon: 'error',
                title: 'Connection Error',
                text: 'Could not connect to the server. Please try again later.'
            });
        });
    });

    // Auto open cart after refresh
    window.addEventListener("load", () => {
        if (localStorage.getItem("openCart") === "true") {
            localStorage.removeItem("openCart");
            const offcanvas = new bootstrap.Offcanvas(document.getElementById('offcanvasCart'));
            offcanvas.show();
        }
    });
</script>

<!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="~/ecommerce-product-page-html-css-javascript-main/main.js" asp-append-version="true"></script>
<script src="~/ecommerce-product-page-html-css-javascript-main/cart.js" asp-append-version="true"></script>
<script src="~/ecommerce-product-page-html-css-javascript-main/slider.js" asp-append-version="true"></script>
