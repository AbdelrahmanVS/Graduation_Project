@model ITIGraduation.Models.Oxford

@{
    ViewData["Title"] = "SportDetails";
}

<link rel="stylesheet" href="~/style.css" asp-append-version="true" />

<div class="product_page" id="ProductView">
    <section class="main">
        <div class="default gallery">
            <div class="main-img">
                <img class="active"
                     src="@Url.Content(Model.ImagUrl)"
                     alt="product-img" />
                <img src="@Url.Content(Model.ImagUrl)" alt="product-img" />
                <img src="@Url.Content(Model.ImagUrl)" alt="product-img" />
                <img src="@Url.Content(Model.ImagUrl)" alt="product-img" />
            </div>
            <div class="thumb-list">
                <div class="active">
                    <img src="@Url.Content(Model.ImagUrl)"
                         alt="@Url.Content(Model.BootName)" />
                </div>
                <div>
                    <img src="@Url.Content(Model.ImagUrl)"
                         alt="@Url.Content(Model.BootName)" />
                </div>
                <div>
                    <img src="@Url.Content(Model.ImagUrl)"
                         alt="@Url.Content(Model.BootName)" />
                </div>
                <div>
                    <img src="@Url.Content(Model.ImagUrl)"
                         alt="@Url.Content(Model.BootName)" />
                </div>
            </div>
        </div>

        <div class="lightbox">
            <div class="gallery">
                <div class="main-img">
                    <!-- icons -->
                    <!-- main images -->
                    <img class="active"
                         src="@Url.Content(Model.ImagUrl)"
                         alt="@Url.Content(Model.BootName)" />
                    <img src="@Url.Content(Model.ImagUrl)" alt="@Url.Content(Model.BootName)" />
                    <img src="@Url.Content(Model.ImagUrl)" alt="@Url.Content(Model.BootName)" />
                    <img src="@Url.Content(Model.ImagUrl)" alt="@Url.Content(Model.BootName)" />
                </div>
                <div class="thumb-list">
                    <div class="active">
                        <img src="@Url.Content(Model.ImagUrl)"
                             alt="@Url.Content(Model.BootName)" />
                    </div>
                    <div>
                        <img src="@Url.Content(Model.ImagUrl)"
                             alt="@Url.Content(Model.BootName)" />
                    </div>
                    <div>
                        <img src="@Url.Content(Model.ImagUrl)"
                             alt="@Url.Content(Model.BootName)" />
                    </div>
                    <div>
                        <img src="@Url.Content(Model.ImagUrl)"
                             alt="@Url.Content(Model.BootName)" />
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <h3></h3>
            <h2 class="product-name">@Url.Content(Model.BootName)</h2>
            <p class="product-desc">
                These low-profile sneakers are your perfect casual wear companion.
                Featuring a durable rubber outer sole, they’ll withstand everything
                the weather can offer.
            </p>
            <div class="price-info">
                <div class="price">
                    <span class="current-price">$@Url.Content(Model.Price.ToString())</span>
                    <span class="discount">50%</span>
                </div>
                <div class="prev-price">$250.00</div>
            </div>
            <div class="add-to-cart-container">
                <div class="counter">
                    <button class="minus">
                        <svg width="12"
                             height="4"
                             xmlns="http://www.w3.org/2000/svg"
                             xmlns:xlink="http://www.w3.org/1999/xlink">
                            <defs>
                                <path d="M11.357 3.332A.641.641 0 0 0 12 2.69V.643A.641.641 0 0 0 11.357 0H.643A.641.641 0 0 0 0 .643v2.046c0 .357.287.643.643.643h10.714Z"
                                      id="a" />
                            </defs>
                            <use fill="#FF7E1B" fill-rule="nonzero" xlink:href="#a" />
                        </svg>
                    </button>
                    <span id="quantity" class="count">1</span>
                    <button class="plus">
                        <svg width="12"
                             height="12"
                             xmlns="http://www.w3.org/2000/svg"
                             xmlns:xlink="http://www.w3.org/1999/xlink">
                            <defs>
                                <path d="M12 7.023V4.977a.641.641 0 0 0-.643-.643h-3.69V.643A.641.641 0 0 0 7.022 0H4.977a.641.641 0 0 0-.643.643v3.69H.643A.641.641 0 0 0 0 4.978v2.046c0 .356.287.643.643.643h3.69v3.691c0 .356.288.643.644.643h2.046a.641.641 0 0 0 .643-.643v-3.69h3.691A.641.641 0 0 0 12 7.022Z"
                                      id="b" />
                            </defs>
                            <use fill="#FF7E1B" fill-rule="nonzero" xlink:href="#b" />
                        </svg>
                    </button>
                </div>
                <button class="add-to-cart" id="addToCartBtn" data-id="@Model.OxfordId">
                    <span>
                        <svg width="22" height="20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.925 3.641H3.863L3.61.816A.896.896 0 0 0 2.717 0H.897a.896.896 0 1 0 0 1.792h1l1.031 11.483c.073.828.52 1.726 1.291 2.336C2.83 17.385 4.099 20 6.359 20c1.875 0 3.197-1.87 2.554-3.642h4.905c-.642 1.77.677 3.642 2.555 3.642a2.72 2.72 0 0 0 2.717-2.717 2.72 2.72 0 0 0-2.717-2.717H6.365c-.681 0-1.274-.41-1.53-1.009l14.321-.842a.896.896 0 0 0 .817-.677l1.821-7.283a.897.897 0 0 0-.87-1.114ZM6.358 18.208a.926.926 0 0 1 0-1.85.926.926 0 0 1 0 1.85Zm10.015 0a.926.926 0 0 1 0-1.85.926.926 0 0 1 0 1.85Zm2.021-7.243-13.8.81-.57-6.341h15.753l-1.383 5.53Z"
                                  fill="#69707D"
                                  fill-rule="nonzero" />
                        </svg>
                    </span>
                    <span>Add to cart</span>
                </button>
            </div>
        </div>
    </section>
</div>
<script>
    // كمية المنتج (كم عدد القطع اللي عايز تضيفها)
    let quantity = 1;
    const quantitySpan = document.getElementById('quantity');
    const minusBtn = document.querySelector('.minus');
    const plusBtn = document.querySelector('.plus');
    const addToCartBtn = document.getElementById('addToCartBtn');

    minusBtn.addEventListener('click', () => {
        if (quantity > 1) {
            quantity--;
            quantitySpan.textContent = quantity;
        }
    });

    plusBtn.addEventListener('click', () => {
        quantity++;
        quantitySpan.textContent = quantity;
    });

       addToCartBtn.addEventListener('click', () => {
        const productId = addToCartBtn.getAttribute('data-id');

        fetch('/Cart/AddToCart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                productId: parseInt(productId),
                quantity: quantity,
                productType: 'Oxford' // غيّر دا حسب نوع المنتج لو مش Oxford
            })
        })
            .then(response => {
                if (response.redirected) {
                    // تم توجيه المستخدم لصفحة تسجيل الدخول
                    alert("يجب تسجيل الدخول أولاً لإضافة المنتج إلى السلة.");
                    window.location.href = response.url; // نحوله يدويًا
                    return;
                }
                return response.json();
            })
            .then(data => {
                if (!data) return; // تم التحويل
                if (data.success) {
                    alert(`تم إضافة ${quantity} قطعة إلى السلة. عدد القطع في السلة الآن: ${data.cartCount}`);
                    quantity = 1;
                    quantitySpan.textContent = quantity;
                } else {
                    alert('حدث خطأ أثناء إضافة المنتج إلى السلة');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('تعذر الاتصال بالخادم. تأكد من أن السيرفر يعمل.');
            });
    });
</script>

<script src="~/ecommerce-product-page-html-css-javascript-main/main.js" asp-append-version="true"></script>
<script src="~/ecommerce-product-page-html-css-javascript-main/cart.js" asp-append-version="true"></script>
<script src="~/ecommerce-product-page-html-css-javascript-main/slider.js" asp-append-version="true"></script>
